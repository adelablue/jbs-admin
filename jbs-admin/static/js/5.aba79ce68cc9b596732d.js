webpackJsonp([5],{CuP3:function(e,t){},iSsa:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s("mvHQ"),a=s.n(r),n=s("P9l9"),o={data:function(){return{postData:{limit:10,offset:0},status:{status:["ready","cancelled","completed"]},eventList:[],pagination:null,total:0,pageShow:!1,currentPage:1,script:{},shop:{},keyword:"",refundsList:[],haveRefund:!1,loading:!1,expands:[],getRowKeys:function(e){return e.id}}},mounted:function(){var e={limit:10,offset:0,status:encodeURIComponent(a()(this.status))};this.$common.getSessionStorage("currentPage")&&(e.offset=(this.$common.getSessionStorage("currentPage")-1)*this.postData.limit,this.currentPage=Number(this.$common.getSessionStorage("currentPage"))),this.$common.getSessionStorage("keyword")&&(e.keyword=this.$common.getSessionStorage("keyword"),this.keyword=this.$common.getSessionStorage("keyword")),this.getEvents(e)},methods:{getEvents:function(e){var t=this;Object(n.a)(e).then(function(e){if(200==e.status){t.$message({type:"success",message:"获取数据成功!"}),t.pageShow=!0;for(var s=e.data.data,r=0;r<s.length;r++)s[r].create_time=Object(n.e)(new Date(s[r].createdAt)),s[r].start_time=Object(n.e)(new Date(s[r].startTime)),s[r].end_time=Object(n.e)(new Date(s[r].endTime)),"ready"==s[r].status?s[r].status2="已成团":"cancelled"==s[r].status?s[r].status2="已解散":"completed"==s[r].status&&(s[r].status2="已完成"),s[r].supportPaymentDisplay=s[r].supportPayment?"是":"否";t.eventList=s,t.total=e.data.pagination.total}})},handleSizeChange:function(e){this.postData.limit=e;var t={limit:e,offset:0,status:encodeURIComponent(a()(this.status))};this.keyword&&(t.keyword=this.keyword,this.$common.setSessionStorage("keyword",this.keyword)),this.getEvents(t)},handleCurrentChange:function(e){this.postData.offset=(e-1)*this.postData.limit,this.currentPage=e,this.$common.setSessionStorage("currentPage",this.currentPage);var t=encodeURIComponent(a()(this.status)),s={limit:10,offset:(e-1)*this.postData.limit,status:t};this.keyword&&(s.keyword=this.keyword,this.$common.setSessionStorage("keyword",this.keyword)),this.getEvents(s)},showOrder:function(e){this.$common.setSessionStorage("eventId",e.id),this.$router.push("events_refund")},searchEvent:function(){var e={limit:10,offset:0,status:encodeURIComponent(a()(this.status))};e.keyword=this.keyword,this.$common.setSessionStorage("keyword",this.keyword),this.getEvents(e)},toggleRowExpansion:function(e,t){var s=this,r=this;if(t.length){if(r.expands=[],e){r.expands.push(e.id),r.refundsList=[];var a=[];Object(n.d)(e.id).then(function(e){if(200==e.status){var t=[],o=e.data.data;r.haveRefund=!0;for(var u=2,i=1;i<o.length;i++)for(var d=0;d<o[i].refunds.length;d++)o[i].refunds[d].amont2=(o[i].refunds[d].refundAmount/100).toFixed(2),o[i].refunds[d].create_time=Object(n.e)(new Date(o[i].refunds[d].createdAt)),"created"==o[i].refunds[d].status&&(o[i].refunds[d].orderStatus2="创建返现"),"refund"==o[i].refunds[d].status&&(o[i].refunds[d].orderStatus2="可返现"),"refund"==o[i].refunds[d].status&&"SUCCESS"==o[i].refunds[d].resultCode&&(o[i].refunds[d].orderStatus2="已返现"),"approved"==o[i].refunds[d].status&&(o[i].refunds[d].orderStatus2="返现中"),"failed"==o[i].refunds[d].status&&(o[i].refunds[d].orderStatus2="返现失败"),o[i].refunds[d].order_id=o[i].id,o[i].refunds[d].nickName=o[i].refunds[d].user.nickName,t.push(o[i].refunds[d]),a=s.getArrSingle(t);o[0].refunds.length>=2&&(u=2);for(var l=0;l<u;l++)o[0].refunds[l].amont2=(Number(o[0].refunds[l].refundAmount)/100).toFixed(2),o[0].refunds[l].create_time=Object(n.e)(new Date(o[0].refunds[l].createdAt)),"created"==o[0].refunds[l].status&&(o[0].refunds[l].orderStatus2="创建返现"),"refund"==o[0].refunds[l].status&&(o[0].refunds[l].orderStatus2="可返现"),"refund"==o[0].refunds[l].status&&"SUCCESS"==o[0].refunds[l].resultCode&&(o[0].refunds[l].orderStatus2="已返现"),"approved"==o[0].refunds[l].status&&(o[0].refunds[l].orderStatus2="返现中"),"failed"==o[0].refunds[l].status&&(o[0].refunds[l].orderStatus2="返现失败"),o[0].refunds[l].order_id=o[0].id,o[0].refunds[l].nickName=o[0].refunds[l].user.nickName,a.push(o[0].refunds[l])}for(var c=0;c<a.length;c++)s.refundsList.push(a[c])})}}else r.expands=[]},getArrSingle:function(e){for(var t=[],s={},r=0;r<e.length;r++)s[e[r].order]||(t.push(e[r]),s[e[r].order]=!0);return t},getRefunds:function(e){var t=this;if("已退款"==e.refundStatus2)return this.$message({type:"error",message:"~@o@~ 已退款的订单不能退款哦! ~@o@~ "}),!1;if("paid"==e.orderStatus&&0==e.refunds.length)return this.$message({type:"error",message:"~@o@~ 未申请退款的订单不能退款哦! ~@o@~ "}),!1;var s={orderId:e.order,refundId:e.id};Object(n.l)(s,{status:"approved"}).then(function(e){200==e.status?t.$message({type:"success",message:"退款操作进行中!"}):t.$message({type:"error",message:"订单退款状态修改失败!"})})}}},u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"containers"},[s("div",{staticClass:"headers"},[s("el-input",{staticStyle:{width:"200px","margin-left":"10px","margin-right":"10px","z-index":"999"},attrs:{type:"text",clearable:"",placeholder:"请输入剧本名称或微信昵称进行搜索"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchEvent(t)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),e._v(" "),s("span",{staticClass:"btn",on:{click:e.searchEvent}},[e._v("搜索")])],1),e._v(" "),s("div",{staticClass:"content"},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.eventList,border:"","header-cell-style":{"background-color":"#ccc",color:"#000"},"row-key":e.getRowKeys,"expand-row-keys":e.expands},on:{"expand-change":e.toggleRowExpansion}},[s("el-table-column",{attrs:{prop:"script",label:"剧本名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.script?t.row.script.name:""))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"shop",label:"店名"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.script?t.row.shop.name:""))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"hostUser",label:"创建者"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.hostUser.nickName))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"status2",width:"100",label:"活动状态"}}),e._v(" "),s("el-table-column",{attrs:{prop:"start_time",label:"开始时间"}}),e._v(" "),s("el-table-column",{attrs:{prop:"end_time",label:"结束时间"}}),e._v(" "),s("el-table-column",{attrs:{prop:"create_time",label:"创建时间"}}),e._v(" "),s("el-table-column",{attrs:{prop:"price",label:"价格(元)"}}),e._v(" "),s("el-table-column",{attrs:{width:"80",type:"expand",label:"查看返现"}},[[s("el-table",{staticStyle:{width:"100%",padding:"0"},attrs:{data:e.refundsList,border:"","header-cell-style":{"background-color":"#fafafa",color:"#000"}}},[s("el-table-column",{attrs:{prop:"outTradeNo",width:"350",label:"订单号"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.outTradeNo))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"nickName",label:"参(发)团人"}}),e._v(" "),s("el-table-column",{attrs:{prop:"refundDesc",label:"返现描述"}}),e._v(" "),s("el-table-column",{attrs:{prop:"create_time",label:"创建时间"}}),e._v(" "),s("el-table-column",{attrs:{prop:"amont2",label:"价格(元)"}}),e._v(" "),s("el-table-column",{attrs:{prop:"orderStatus2",label:"订单状态"}}),e._v(" "),s("el-table-column",{attrs:{prop:"returnMsg",label:"状态描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.returnMsg?s("span",{attrs:{type:"primary"}},[e._v(e._s(t.row.returnMsg))]):e._e()]}}])}),e._v(" "),s("el-table-column",{attrs:{width:"150",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return["创建返现"==t.row.orderStatus2||"可返现"==t.row.orderStatus2?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(s){return e.getRefunds(t.row)}}},[e._v("返现")]):e._e(),e._v(" "),"failed"==t.row.status?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(s){return e.getRefunds(t.row)}}},[e._v("再次尝试")]):s("el-button",{attrs:{size:"mini",type:"primary",disabled:""}},[e._v("返现")])]}}])})],1)]],2),e._v(" "),s("el-table-column",{attrs:{prop:"supportPaymentDisplay",label:"支持支付?"}})],1)],1),e._v(" "),e.pageShow?s("div",{staticClass:"Pagination Pagination2"},[s("el-pagination",{attrs:{background:"","current-page":e.currentPage,"pager-count":5,"page-sizes":[10,20,25,50,100],"page-size":10,total:e.total,layout:"total, prev, pager, next"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):e._e()])},staticRenderFns:[]};var i=s("VU/8")(o,u,!1,function(e){s("CuP3")},"data-v-7e7c2a9b",null);t.default=i.exports}});